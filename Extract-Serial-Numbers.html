<html>
<head>
<title>
Extract Serial Numbers v1.2
</title>
<meta name="author" content="Matt Landau">
<script>

function extractSerialNumbers(textAreaID, separator, countID = "") {
  const rModels = /(r\d{3})|(r1)|(r2)|(r2_180)|(r3)|(r4)/;
  const drModels = /(dr\d{2})|(dr1)/;
  const dcModels = /(dc\d{2})|(dc1)/;
  const dModels = /(d1)|(d10)|(d20)/;
  const bModels = /(b10)|(b15)/;
  const eModels = /(e10)|(e2)|(e50)/;
  const aModels = /(a100)/;
  const nModels = /(n100)/;
  const mModels = /(m15)/;
  const tModels = /(t1)/;
  const sVariations = /(s)/;
  const oldSequence = /(\d{8})/;
  const modelSeriesSeparator = /(-)/;
  const newSequence = /(b\d{2}([a-l]\d{4}))/;
  const termination = /(?=($|\D\s))/;

  const regexPattern = new RegExp("(" + rModels.source + "|" + drModels.source + "|" + dcModels.source + "|" + bModels.source + "|" + eModels.source + "|" + aModels.source + "|" + nModels.source + "|" + mModels.source + "|" + tModels.source  + ")(" + sVariations.source + ")?" + "(" + modelSeriesSeparator + ")" + oldSequence.source + "|" + newSequence.source + termination.source + ")", "gi");
  
  const formValue = document.getElementById(textAreaID).value
  const matches= formValue.toUpperCase().match(regexPattern) || [];
  const uniqueMatches = [...new Set(matches.sort())];
  const deviceCount = uniqueMatches.length + " unique serials";

  const result = uniqueMatches.length > 0 ? uniqueMatches.join(separator) : "no matches";
  document.getElementById(textAreaID).value = result

  if (countID != "") {
    document.getElementById(countID).innerHTML = deviceCount
  }
}


function copyToClipboard() {
    toastUp("Copied to clipboard")
    navigator.clipboard.writeText(document.getElementById("myTextToFilterForSerialNumbers").value);
}

</script>
</head>
<body>
<h3>Extract Serial Numbers 2.1</h3>
  <div id="extract-serial-numbers-tool">
    <hr />
    <div>
        <strong>Extract Serial Numbers from plain text</strong>
    </div>
    <textarea id="text_containing_serial_numbers" placeholder="Paste any text" rows="8" cols="80"></textarea>
    <br />
    <button onclick="extractSerialNumbers('text_containing_serial_numbers', '|', 'serial_number_count')">Extract Serials (pipe separated)</button>
    <button onclick="extractSerialNumbers('text_containing_serial_numbers', '\n', 'serial_number_count')">Extract Serials (newline separated)</button>
    <button onclick="extractSerialNumbers('text_containing_serial_numbers', ',', 'serial_number_count')">Extract Serials (comma separated)</button>
    <br />
    <button onclick="copyTextToClipboard(document.getElementById('text_containing_serial_numbers').value).then(upperToast('Text copied', 'positive')).catch(error => upperToast(error, 'negative'));">
        Copy to Clipboard
    </button>
    <p id="serial_number_count" />
</div>
</body>
</html>




  <!-- EXTRACT SERIAL NUMBERS TOOL
  <div id="extract-serial-numbers-tool">
    <hr />
    <div>
        <strong>Extract Serial Numbers from plain text</strong>
    </div>
    <textarea id="text_containing_serial_numbers" placeholder="Paste any text" rows="8" cols="80"></textarea>
    <br />
    <div class="item_div stats_op" onclick="extractSerialNumbers('text_containing_serial_numbers', '|', 'serial_number_count')">Extract Serials (pipe separated)</div>
    <div class="item_div stats_op" onclick="extractSerialNumbers('text_containing_serial_numbers', '\n', 'serial_number_count')">Extract Serials (newline separated)</div>
    <div class="item_div stats_op" onclick="extractSerialNumbers('text_containing_serial_numbers', ',', 'serial_number_count')">Extract Serials (comma separated)</div>
    <br />
    <div class="item_div stats_op" 
        onclick="copyTextToClipboard(document.getElementById('text_containing_serial_numbers').value).then(upperToast('Text copied', 'positive')).catch(error => upperToast(error, 'negative'));">
        Copy to Clipboard
    </div>
    <p id="serial_number_count" /> 
</div> -->

<!--             
            /*
 * This function user regular expressions to match known serial number patterns, circa April 2025
 * - textAreaID (required): the input <textarea> where a user can paste in any text; this element is also assigned the output result
 * - seperator (required): the character(s) used for separating the output values
 * - countID (optional): an element that can be assigned a count of found serial numbers
 */
function extractSerialNumbers(textAreaID, separator, countID = "") {
  const rModels = /(r\d{3})|(r1)|(r2)|(r2_180)|(r3)|(r4)/;
  const drModels = /(dr\d{2})|(dr1)/;
  const dcModels = /(dc\d{2})|(dc1)/;
  const dModels = /(d1)|(d10)|(d20)/;
  const bModels = /(b10)|(b15)/;
  const eModels = /(e10)|(e2)|(e50)/;
  const aModels = /(a100)/;
  const nModels = /(n100)/;
  const mModels = /(m15)/;
  const tModels = /(t1)/;
  const sVariations = /(s)/;
  const oldSequence = /(\d{8})/;
  const modelSeriesSeparator = /(-)/;
  const newSequence = /(b\d{2}([a-l]\d{4}))/;
  const termination = /(?=($|\D\s))/;

  const regexPattern = new RegExp("(" + rModels.source + "|" + drModels.source + "|" + dcModels.source + "|" + bModels.source + "|" + eModels.source + "|" + aModels.source + "|" + nModels.source + "|" + mModels.source + "|" + tModels.source  + ")(" + sVariations.source + "?)(" + (" + modelSeriesSeparator + ")" + oldSequence.source + "|" + newSequence.source + termination.source + ")", "gi");
  const formValue = document.getElementById(textAreaID).value
  const matches= formValue.toUpperCase().match(regexPattern) || [];
  const uniqueMatches = [...new Set(matches.sort())];
  const deviceCount = uniqueMatches.length + " unique serials";
  
  const result = uniqueMatches.length > 0 ? uniqueMatches.join(separator) : "no matches";
  document.getElementById(textAreaID).value = result

  if (countID != "") {
    document.getElementById(countID).innerHTML = deviceCount
  }
}

/*
 * Returns a Promise. Successful promise contains no parameter,
 * rejected promise contains an error string as param. Example usage:
 *
 * copyTextToClipboard('some text value').then(() => alert("success!")).catch((error) => alert(error));
 * 
 * TODO: decide if this function should be in internal.js, similar to copyToClipboard()
 *
 */
function copyTextToClipboard(text) {
  let returnedPromise = null;
  if (text != "") {
    if (navigator.clipboard) {
      returnedPromise = navigator.clipboard.writeText(text);
    } else {
      // fallback to deprecated document.execCommand('copy')
      document.execCommand("copy");
      // assume success since we know there was some visible text
      returnedPromise = new Promise((resolve, reject) => {
        resolve();
      });
    }
  } else {
    // attempts to place an empty string in the clipboard do not appear to work
    returnedPromise = new Promise((resolve, reject) => {
      reject("No content to copy");
    });
  }
  return returnedPromise;
}
 -->
